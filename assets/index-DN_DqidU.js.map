{"version":3,"mappings":"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","names":["docCache","fallbackData","fetchDocData","pk","response","data","attributes","docInfo","error","fetchDocList","DocList","lazy","__vitePreload","useDocList","setPK","useState","docs","setDocs","Article","Catalogue","Sheet","module","SheetContent","SheetDescription","SheetHeader","SheetTitle","Docs","doc","setDoc","isLoading","setIsLoading","docListOpen","setDocListOpen","catalogueOpen","setCatalogueOpen","view","useView","handleDocSelect","newPk","useEffect","newDocs","docData","DocListToggle","jsx","Button","buttonStyle","Library","iconSize","CatalogueToggle","TableOfContents","paddingY","renderDocList","setPKWrapper","value","docListComponent","jsxs","VisuallyHidden","cn","renderCatalogue","catalogueComponent","Fragment","StarIcon"],"ignoreList":[],"sources":["../../frontend/src/api/doc-api.ts","../../frontend/src/hooks/use-doc-list.ts","../../frontend/src/pages/docs/index.tsx"],"sourcesContent":["import type { AstNode, Attribute } from \"@/components/node-renderer\";\r\n\r\nexport type DocInfo = AstNode & {\r\n  title: string;\r\n  tags: string[];\r\n  date: string;\r\n};\r\nexport type DocRow = {\r\n  title: string;\r\n  date: string;\r\n  tags: string[];\r\n  pk: string;\r\n};\r\ntype DocDatabase = {\r\n  [key: string]: DocInfo;\r\n};\r\n\r\nconst docCache: DocDatabase = {};\r\n\r\nconst fallbackData: DocDatabase = {\r\n  notFound: {\r\n    title: \"Not Found\",\r\n    type: \"document\",\r\n    tags: [],\r\n    date: \"\",\r\n  },\r\n};\r\n\r\nconst fetchDocData = async (pk: string): Promise<DocInfo> => {\r\n  if (docCache[pk]) {\r\n    return docCache[pk];\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(`/docs/${pk}/doc.json`);\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to fetch doc data: ${response.statusText}`);\r\n    }\r\n\r\n    const data: AstNode = await response.json();\r\n    const attributes = data.attributes as Attribute;\r\n    const docInfo: DocInfo = {\r\n      type: \"document\",\r\n      title: attributes.title as string,\r\n      tags: attributes.tags as string[],\r\n      date: attributes.date as string,\r\n      children: data.children,\r\n    };\r\n    docCache[pk] = docInfo;\r\n    return docInfo;\r\n  } catch (error) {\r\n    console.error(`Error fetching doc data from ${pk}:`, error);\r\n    return fallbackData[\"notFound\"];\r\n  }\r\n};\r\n\r\nconst fetchDocList = async (): Promise<DocRow[]> => {\r\n  try {\r\n    const response = await fetch(\"/data/docs-db.json\");\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to fetch doc list: ${response.statusText}`);\r\n    }\r\n    const data: DocRow[] = await response.json();\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error fetching doc list:\", error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport { fetchDocData, fetchDocList };\r\n","import type { DocRow } from \"@/api/doc-api\";\r\nimport { lazy, useState } from \"react\";\r\nconst DocList = lazy(() => import(\"@/pages/docs/doc-list\"));\r\n\r\nexport default function useDocList() {\r\n  const [pk, setPK] = useState<string>(\"\");\r\n  const [docs, setDocs] = useState<DocRow[]>([]);\r\n  return {\r\n    pk,\r\n    setPK,\r\n    docs,\r\n    setDocs,\r\n    DocList,\r\n  };\r\n}\r\n","import { useState, useEffect, lazy } from \"react\";\r\nimport { type DocInfo, fetchDocData } from \"@/api/doc-api\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport useView from \"@/hooks/use-view\";\r\nimport useDocList from \"@/hooks/use-doc-list\";\r\nimport { fetchDocList } from \"@/api/doc-api\";\r\nimport StarIcon from \"@/components/star-icon\";\r\nimport { Library, TableOfContents } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { buttonStyle, iconSize } from \"@/constants/icon-button-style\";\r\nimport { VisuallyHidden } from \"@radix-ui/react-visually-hidden\";\r\n\r\n// Lazy load page components\r\nconst Article = lazy(() => import(\"./article\"));\r\nconst Catalogue = lazy(() => import(\"./catalogue\"));\r\n\r\n// Lazy load UI components\r\nconst Sheet = lazy(() => import(\"@/components/ui/sheet\").then((module) => ({ default: module.Sheet })));\r\nconst SheetContent = lazy(() => import(\"@/components/ui/sheet\").then((module) => ({ default: module.SheetContent })));\r\nconst SheetDescription = lazy(() =>\r\n  import(\"@/components/ui/sheet\").then((module) => ({ default: module.SheetDescription })),\r\n);\r\nconst SheetHeader = lazy(() => import(\"@/components/ui/sheet\").then((module) => ({ default: module.SheetHeader })));\r\nconst SheetTitle = lazy(() => import(\"@/components/ui/sheet\").then((module) => ({ default: module.SheetTitle })));\r\n\r\nexport default function Docs() {\r\n  const [doc, setDoc] = useState<DocInfo>({ title: \"\", tags: [], date: \"\", type: \"document\" });\r\n  const [isLoading, setIsLoading] = useState<boolean>(true);\r\n  const [docListOpen, setDocListOpen] = useState<boolean>(false);\r\n  const [catalogueOpen, setCatalogueOpen] = useState<boolean>(false);\r\n  const view = useView();\r\n  const { pk, setPK, docs, setDocs, DocList } = useDocList();\r\n\r\n  // Function to handle document selection and close sheet\r\n  const handleDocSelect = (newPk: string) => {\r\n    setPK(newPk);\r\n    setDocListOpen(false);\r\n  };\r\n\r\n  // Fetch doc list when component mounts\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const newDocs = await fetchDocList();\r\n        setDocs(newDocs);\r\n\r\n        // Only set the first doc if we have docs and pk is empty\r\n        if (newDocs.length > 0) {\r\n          setPK(newDocs[0].pk);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching doc list:\", error);\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    fetchData();\r\n  }, [setDocs, setPK]); // Include dependencies\r\n\r\n  // Fetch doc data when pk changes\r\n  useEffect(() => {\r\n    // Only fetch if pk is not empty\r\n    if (!pk) return;\r\n\r\n    const fetchData = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const docData = await fetchDocData(pk);\r\n        setDoc(docData);\r\n      } catch (error) {\r\n        console.error(`Error fetching doc data from ${pk}:`, error);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    fetchData();\r\n  }, [pk]);\r\n\r\n  // Update document title when doc changes\r\n  useEffect(() => {\r\n    if (doc.title) {\r\n      document.title = `${doc.title}`;\r\n    } else {\r\n      document.title = \"Docs\";\r\n    }\r\n  }, [doc.title]);\r\n\r\n  function DocListToggle() {\r\n    return (\r\n      <Button variant=\"ghost\" className={buttonStyle} onClick={() => setDocListOpen(true)}>\r\n        <Library className={iconSize} />\r\n      </Button>\r\n    );\r\n  }\r\n  function CatalogueToggle() {\r\n    return (\r\n      <Button variant=\"ghost\" className={buttonStyle} onClick={() => setCatalogueOpen(true)}>\r\n        <TableOfContents className={iconSize} />\r\n      </Button>\r\n    );\r\n  }\r\n  const paddingY = \"py-[3.5rem]\";\r\n  // Render DocList component based on view mode\r\n  const renderDocList = () => {\r\n    // For narrow view, we use a wrapper function that matches the expected type\r\n    const setPKWrapper =\r\n      view === \"narrow\"\r\n        ? (value: React.SetStateAction<string>) => {\r\n            // Handle both function and direct value forms of SetStateAction\r\n            const newPk = typeof value === \"function\" ? (value as (prevState: string) => string)(pk) : value;\r\n            handleDocSelect(newPk);\r\n          }\r\n        : setPK;\r\n\r\n    const docListComponent = <DocList docs={docs} pk={pk} setPK={setPKWrapper} />;\r\n\r\n    if (view === \"narrow\") {\r\n      return (\r\n        <Sheet open={docListOpen} onOpenChange={setDocListOpen}>\r\n          <SheetContent side=\"left\" className=\"w-[65vw] sm:w-[350px] p-0 pt-10\">\r\n            <VisuallyHidden asChild>\r\n              <SheetHeader>\r\n                <SheetTitle>Document List</SheetTitle>\r\n                <SheetDescription>Document List</SheetDescription>\r\n              </SheetHeader>\r\n            </VisuallyHidden>\r\n            <div className=\"px-4 py-2 overflow-y-auto h-full\">{docListComponent}</div>\r\n          </SheetContent>\r\n        </Sheet>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className={cn(\"fixed flex flex-col mx-auto\", \"w-[20vw] h-[100vh]\", \"pr-[1rem] pl-[1.6rem]\", paddingY)}>\r\n        {docListComponent}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Render Catalogue component based on view mode\r\n  const renderCatalogue = () => {\r\n    const catalogueComponent = <Catalogue key={pk} doc={doc} />;\r\n\r\n    if (view === \"narrow\") {\r\n      return (\r\n        <Sheet open={catalogueOpen} onOpenChange={setCatalogueOpen}>\r\n          <SheetContent side=\"right\" className=\"w-[65vw] sm:w-[350px] p-0 pt-10\">\r\n            <VisuallyHidden asChild>\r\n              <SheetHeader>\r\n                <SheetTitle>Table of Contents</SheetTitle>\r\n                <SheetDescription>Table of Contents</SheetDescription>\r\n              </SheetHeader>\r\n            </VisuallyHidden>\r\n            <div className=\"px-4 py-2 overflow-y-auto h-full\">{catalogueComponent}</div>\r\n          </SheetContent>\r\n        </Sheet>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className={cn(\"fixed flex flex-col mx-auto\", \"w-[20vw] h-[100vh] right-0\", \"pr-[1.6rem] pl-[1rem]\", paddingY)}\r\n      >\r\n        {catalogueComponent}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"flex flex-row\">\r\n        {view === \"wide\" && renderDocList()}\r\n        <div\r\n          className={cn(\r\n            \"fixed flex flex-col justify-center mx-auto\",\r\n            view === \"narrow\" ? \"w-[100vw] px-0.5\" : \"w-[60vw] left-[20vw] right-[20vw]\",\r\n            \"h-[100vh]\",\r\n            paddingY,\r\n          )}\r\n        >\r\n          {isLoading && pk ? (\r\n            <div className=\"flex items-center justify-center h-full\">\r\n              <StarIcon\r\n                variant=\"primary\"\r\n                size={500}\r\n                animation=\"rotate\"\r\n                strokeWidth={0.2}\r\n                title=\"\"\r\n                animationDuration={2}\r\n              />\r\n            </div>\r\n          ) : (\r\n            <Article key={pk} pk={pk} doc={doc} />\r\n          )}\r\n        </div>\r\n        {view === \"wide\" && renderCatalogue()}\r\n      </div>\r\n\r\n      {view === \"narrow\" && renderDocList()}\r\n      {view === \"narrow\" && renderCatalogue()}\r\n\r\n      <div className=\"fixed bottom-4 left-4 z-50\" hidden={view === \"wide\"}>\r\n        <DocListToggle />\r\n      </div>\r\n      <div className=\"fixed bottom-4 right-4 z-50\" hidden={view === \"wide\"}>\r\n        <CatalogueToggle />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"file":"assets/index-DN_DqidU.js"}